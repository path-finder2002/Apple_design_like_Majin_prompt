# Googleスライド MVP 設計書

## 1. ドキュメント情報
- 作成日: 2025-09-23
- バージョン: 0.1 (初版)
- 作成者: Developer Agent (Codex)
- 関連ドキュメント: `requirements.md`, `ROADMAP.md`, `component_requirements.md`, `code.js`

## 2. プロジェクト概要
- 目的: Google Apps Script（GAS）でまじん式スライドの資産を活かし、Apple HIG に準拠したミニマルで洗練された Google スライド資料を半自動生成する。
- コンセプト: 余白・タイポグラフィ中心の構成、ライト/ダーク切替、アクセントカラー制御、Apple 風演出（デバイスフレーム/黒背景/モノトーン）をトークン化して再利用性を高める。
- 成果物: MVP 版 Google スライドジェネレーター（Apps Script プロジェクト）と、それを支えるドキュメント群。

## 3. MVP 目標と成功指標
- 30 分以内に 10 枚構成の Apple 風プレゼン資料を生成できるフローを実装する。
- テンプレート 8 種（カバー、ミニマルセクション、ワイドヒーロー、カードレスフィーチャー、シンプル比較、ナラティブタイムライン、ステートメント引用、数値ハイライト）を選択生成できる。
- ライト/ダークテーマと 1 つのアクセントカラー（Aqua）を切り替えられる UI を提供する。
- 生成されたスライドの余白・行間・フォントサイズが `CONFIG.APPLE_TOKENS` の定義と一致することを単体テストで担保する。

## 4. スコープ定義
- インスコープ
  - Apps Script メニュー「Apple Presentation」からの生成・設定 UI。
  - デザイン・タイポグラフィトークンの集中管理 (`CONFIG.APPLE_TOKENS`)。
  - Apple 風テンプレート 8 種のレイアウト・スタイル適用。
  - ライト/ダークテーマ切替、アクセントカラー適用ロジック。
  - スライド生成パイプライン（データ入力 → テンプレート適用 → 配置調整）。
- アウトオブスコープ
  - Apple 公式アセットの配布や動的取得。
  - 外部 API 連携、画像編集、3D アニメーション生成。
  - 多言語化 UI および詳細な共同編集フロー。

## 5. 想定ユーザーとユースケース
- 想定ユーザー: Apple テイストの資料を短時間で用意したいビジネスチーム、デザイナー、プレゼンター。
- プライマリーユースケース
  1. テンプレート設定を確認 → ライト/ダークを選択 → 既存アウトラインを貼り付け → 自動生成 → 軽微な手動調整 → 配布。
  2. 既存スライドに Apple テイストの演出（アクセントカラー、引用レイアウト）を部分適用。
  3. プロダクト紹介イベント向けに Apple 風 KPI やスペック比較のスライドを生成。

## 6. MVP機能要件（抜粋）
| ID | 要件概要 | MVP適用方針 | 備考 |
|----|----------|-------------|------|
| FR-01 | カスタムメニュー | 起動時に `onOpen` でメニュー登録し、生成・設定ダイアログへ遷移 | `UIService` を使用 |
| FR-02 | テーマ選択 | ダイアログでライト/ダークを選択し `CONFIG.APPLE_TOKENS.theme` に反映 | デフォルトはダーク |
| FR-03 | テンプレート 8 種 | 各テンプレートを `LAYOUTS.appleMvp` に定義し、生成時に選択的に描画 | 画像要素はダミー/プレースホルダー対応 |
| FR-04 | デザイントークン | 余白・行間・フォントサイズを `CONFIG.APPLE_TOKENS` に集約 | トークンは JSON ライク構造 |
| FR-05 | スクリプトプロパティ | 最終選択テーマやアクセントカラーを保存・再利用 | `PropertiesService.getUserProperties()` |

## 7. 非機能要件
- 実行時間: 1 回の生成で 60 秒以内（Apps Script 標準制限を考慮）。
- 安定性: 失敗時はユーザーに通知し、エラー内容をログ (`Logger.log`) に記録。
- メンテナンス性: テンプレート・トークンはモジュール化し、他テーマの追加に備える。
- アクセシビリティ: コントラスト比 4.5:1 以上を確保する配色（ライト/ダーク両テーマ）。

## 8. 体験設計とデザイン指針
- タイポグラフィ: フォント `Inter`（SF Pro 代替）、ヘッドライン・サブヘッド・本文の階層をトークン化。
- カラー: ベースはモノトーン (#000, #111, #F5F5F7) に Aqua (#3EDDFF) のアクセントを適用。
- レイアウトグリッド: マージン 80pt、カラム 12 グリッドの概念を内部トークンで再現。
- モーション: MVP 時点では静的配置。将来的なトランジション制御は後続課題。
- 画像/アイコン: `img/` 以下の参照画像を参考に、仮プレースホルダー矩形で表現。

## 9. システム構成（Apps Script モジュール）
- `CONFIG`: テーマ、フォントスケール、スペーシング、アクセントカラーを保持。
- `SlideBuilder`: テンプレート別描画関数、要素配置ヘルパー。
- `MenuController`: `onOpen` からカスタムメニューを配置し、UI ダイアログ起動。
- `Dialog`: HTMLService でテーマ選択/テンプレート選択 UI を提供。
- `DataProvider`: スライド構成データ（タイトル、本文、画像パス等）を扱う。
- `PropertiesStore`: ユーザー設定をスクリプトプロパティへ保存。
- ログ・ユーティリティ: デバッグ、計測、バリデーションヘルパー。

## 10. データモデルとテンプレート仕様
```javascript
const slideData = [
  {
    type: 'cover',
    title: 'MacBook Pro',
    subtitle: 'Beyond Pro.',
    accent: 'aqua',
    media: { kind: 'image', key: 'hero_macbook' }
  },
  {
    type: 'featureCardless',
    headline: '10-core CPU',
    description: ['4 performance cores', '6 efficiency cores'],
    media: { kind: 'graphic', key: 'cpu_die' }
  }
];
```
- `type`: `cover` / `section` / `wideHero` / `cardlessFeature` / `comparisonSimple` / `timelineNarrative` / `quoteStatement` / `highlightMetric`。
- `media`: `image` or `graphic`（Apps Script ではドライブ内画像 ID を取得して差し込む想定）。
- MVP では JSON 形式を `code.js` 内に直接定義し、将来的なスプレッドシート連携に備える。

## 11. フロー概要
1. ユーザーがスライドを開くと `onOpen` がメニューを追加。
2. メニューから「Apple Slides → Generate」を選択 → HTML ダイアログでテーマ/テンプレート構成を入力。
3. 入力結果を `google.script.run` 経由で GAS に送信。
4. `SlideBuilder.generateSlides(slideData, config)` が各テンプレートを描画。
5. 完了メッセージをダイアログで通知。必要に応じてログを出力。

## 12. 開発マイルストーン（MVP）
- フェーズ0: 環境整備 (`clasp` 設定確認、`code.js` 既存資産のバックアップ)。
- フェーズ1: トークン定義リファクタリング（`CONFIG.APPLE_TOKENS` 作成、既存定数の統合）。
- フェーズ2: テンプレート 8 種の描画関数を実装し、サンプルデータで動作確認。
- フェーズ3: HTML ダイアログでのテーマ選択 UI とユーザープロパティ保存を構築。
- フェーズ4: テスト（ユニット/統合）、QA リストに沿ったビジュアル確認。
- フェーズ5: ドキュメント更新、`clasp push`、ユーザーレビュー。

## 13. テスト戦略
- ユニットテスト: テンプレート別関数が正しいスタイル・座標を返すかを Apps Script テストフレームワークで検証。
- スナップショット検証: 生成したスライドを手動で確認し、`component_requirements.md` の要件を満たすかチェックリスト化。
- 回帰テスト: テーマトグルやトークン変更が既存テンプレートに影響しないことを確認。
- パフォーマンステスト: 10 枚生成時の処理時間をログで計測し、60 秒以内に収まることを確認。

## 14. リスクと対策
- フォント置換リスク: `Inter` 未導入環境では代替フォントズレが発生 → 代替フォント一覧とガイドを提供。
- GAS 実行時間制限: 大量画像挿入でタイムアウト → 画像圧縮とバッチ挿入順序を最適化。
- デザイン再現性: Google Slides API 制限で細かな調整が困難 → 最低限の代替スタイルを事前に定義。
- トークン肥大化: テーマ追加で複雑化 → JSON 構造を階層化し、用途別に分割。

## 15. 今後の拡張候補
- マルチアクセントカラー、Apple ダイナミックグレーディエント対応。
- 外部データソース（スプレッドシート/Notion）との連携による自動データ注入。
- Slide API を活用したアニメーション設定、自動画像クロッピング。
- QA 支援のためのビジュアル diff ツール連携。

## 16. ドキュメント更新ルール
- 変更があった場合、セクション単位で更新しバージョン番号をインクリメント。
- コード変更と同時に `clasp push` を実施し、Apps Script 環境とドキュメントの整合性を保つ。
- 更新履歴は Git のコミットメッセージと紐づける。

---
本設計書は MVP 実装時の指針として利用し、後続フェーズでのテンプレート拡充や自動化強化に備える。
